{% load humanize %}
{#{% load l10n %}#}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>首页详情</title>
    <script src="/static/wechat/js/jquery-1.11.3.js"></script>
    <script src="/static/wechat/js/guppies.js"></script>
    <link href="/static/wechat/css/guppiesStyle.css" type="text/css" rel="stylesheet"/>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <script>
        document.getElementsByTagName("html")[0].style.fontSize=window.screen.width/10+"px";
    </script>
    <style>
        .active{ color: #31b0d5; }
    </style>
</head>
<body>
<div class="doc">
    <div class="homePage-details">
        <div class="borderColor"></div>
        <div class="userInfo-details">
            <div class="userImg-details"><img src="{{ photo.user.userinfo.avatar_url }}"/></div>
            <span>{{ photo.user.userinfo.nickname }}</span>
            <em>{{ photo.created_at | naturaltime }}</em>
        </div>
        <div class="guppiesInfo">
            {{ photo.description }}
        </div>
        <div class="guppiesImg">
            <img src="{{ photo.url }}?imageView2/5/w/1280/h/1280"/>
        </div>
        <div class="guppiesCheck">
            <span>查看&nbsp;<em>{{ photo.n_total_watched }}</em></span>
            <span>收藏&nbsp;<em>{{ photo.n_account_vote }}</em></span>
            <span>{{ photo.n_account_mark }}人最终评分:&nbsp;<em>{{ photo.n_avg_mark }}</em></span>
            <a href="javascript:;">详细规则</a>
        </div>
        <div class="userGood">
            <p>点赞&nbsp;<em>{{ votes | length }}</em></p>
            {% if votes %}
                {% for vote in votes %}
                    <span><img src="{{ vote.user.userinfo.avatar_url }}"></span>
                {% endfor %}
                <span><a href="/wechat/photos/{{ photo.id }}/votes">...</a></span>
            {% endif %}
        </div>
        <div class="comment">
            <div class="commentNum">全部评论&nbsp;<span>{{ comments | length }}</span></div>
            <div class="commentList">
                {% for comment in comments %}
                <div class="list">
                    <div class="listTitle">
                        <div class="listImg"><img src="{{ comment.user.userinfo.avatar_url }}"/></div>
                        <span>{{ comment.user.userinfo.nickname }}</span>
                        <em>{{ comment.created_at | naturaltime }}</em>
                    </div>
                    <div class="commentCon">
                        {{ comment.description }}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="detailsBanner" data-photo-id="{{ photo.id }}">
            <a class="getStore {% if photo.is_favorite %}active{% endif %}" href="#">{% if photo.is_favorite %}已{% endif %}收藏</a>
            <a class="getGood {% if photo.is_voted %}active{% endif %}" href="#">{% if photo.is_voted %}已{% endif %}点赞</a>
            <a class="getScore" href="#">{% if photo.is_marked %}已{% endif %}评分</a>
            <a href="#">评论</a>
        </div>
    </div>
</div>
<script>
    // ajax
    $('.getGood').click(function(){
        if($(this).hasClass('active')){
            $.ajax({
                method:'DELETE',
                url:'/wechat/api/photos/' + $('.detailsBanner').data('photo-id') + '/votes',
                success:function(data){
                    console.log(data);
                    $('.getGood').removeClass('active').text('点赞');
                }
            })
        }else{
            $.ajax({
                method:'POST',
                url:'/wechat/api/photos/' + $('.detailsBanner').data('photo-id') + '/votes',
                success:function(data){
                    console.log(data);
                    $('.getGood').addClass('active').text('已点赞');
                }
            })
        }
    });
    $('.getStore').click(function(){
        if($(this).hasClass('active')){
            $.ajax({
                method:'DELETE',
                url:'/wechat/api/photos/' + $('.detailsBanner').data('photo-id') + '/favorites',
                success:function(data){
                    console.log(data);
                    $('.getStore').removeClass('active').text('收藏');
                }
            });
        }else{
            $.ajax({
                method:'POST',
                url:'/wechat/api/photos/'+ $('.detailsBanner').data('photo-id') +'/favorites',
                success:function(data){
                    console.log(data);
                    $('.getStore').addClass('active').text('已收藏');
                }
            });
        }
    });
    $('.getScore').click(function(){
        $.ajax({
            method:'POST',
            url:'/wechat/api/photos/'+ $('.detailsBanner').data('photo-id') +'/marks',
            success:function(data){
                console.log(data);
            }
        });
    });
</script>
</body>
</html>
